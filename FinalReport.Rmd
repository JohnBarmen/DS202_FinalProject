---
title: "DS 202 Final Project"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyr)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(ipumsr)
library(gridExtra)
library(formattable)
ddi <- read_ipums_ddi("usa_00002.xml")
data <- read_ipums_micro(ddi)

```

## Introduction/Background:

Our group wanted to take an in-depth look at American work-life balance. There are many facets to explore, such as how sex, job type, marital status, location, age, and number of dependents play a role in work-life balance, and how this has changed over time.

We collected our data from the IPUMS database, which has a collection of American Census data as well as American Community Surveys. The Census records span from 1790-2010, and the American Community Surveys span from 2000-present. The IPUMS database provides free access to social and economic data, and there is a massive collection of observations, with a wide array of variables.  



## Data Collection:

On IPUMS database, we selected a subset of variables and then selected a sample of 15,000 households per census/survey. We narrowed our scope to be from 1980-now, to get a better look at the most recent changes in work-life balance.

## Questions
<> Start Example
<> TODO: Remove this block
    
    ```{r}
    data %>%
      filter(CLASSWKR > 0) %>%
      mutate(UHRSWORK = ifelse(YEAR == 2000, UHRSWORK / 2, UHRSWORK)) %>%
      ggplot(aes(x=YEAR, y=UHRSWORK)) + geom_bar(fill = "deepskyblue", stat="identity") +
      labs(x="Year", y= "Total Hours Worked per week", title="Hours of Work Per Week per Year") +
      geom_vline(xintercept=2009, color="red") +
      annotate("label", x=2008, y=7.5e5, label="Great Recession", hjust=0, fill="red", color="white")
    ```

<> End Example


### How has the family breadwinner role changed over time?

### How does state affect the relationship between work/life balance?



### How does gender play a role in work/life balance?

```{r}
tbl <- data %>% 
  filter(EMPSTAT == 1) %>% 
   mutate(Sex = if_else(SEX==1, "Male", "Female")) %>% 
  group_by(Sex) %>% 
  summarise("Average Hours per Week" = mean(UHRSWORK), "Average Travel Time" = mean(TRANTIME))
formattable(tbl)
```


To calculate average workweeks and commutes, we first removed all people of unemployed work status, so we would not be diluting our numbers with zeroes for hours worked per week and commute time. We can see that overall, on average men work more per week than women, with an average of about 42 hours per week as opposed to 36 hours per week. We can also see that men have slightly longer commutes, averaging about 25 minutes versus womenâ€™s average commutes of 21 minutes. 



**How has workweek and commute changed over time?**


```{r, message=FALSE}
p_hours <- data %>% 
  filter(EMPSTAT == 1) %>% 
  group_by(YEAR, SEX) %>% 
  summarise("Average Hours per Week" = mean(UHRSWORK), "Average Travel Time" = mean(TRANTIME)) %>% 
  ggplot(aes(x=YEAR, y=`Average Hours per Week`, color= as.factor(SEX))) + geom_line() + labs(title = "Average Workweek by Sex over Time", x = "Year", y= "Average Hours/Week") +
  scale_color_manual(name="Sex", labels = c("Male","Female"), values=c('steelblue1','Pink'))

p_travel <- data %>% 
  filter(EMPSTAT == 1) %>% 
  group_by(YEAR, SEX) %>% 
  summarise("Average Hours per Week" = mean(UHRSWORK), "Average Travel Time" = mean(TRANTIME)) %>% 
  ggplot(aes(x=YEAR, y=`Average Travel Time`, color= as.factor(SEX))) + geom_line() + labs(title = "Average Commute by Sex over Time", x = "Year", y="Travel Time (min)") + scale_color_manual(name="Sex",labels = c("Male", "Female"), values=c('steelblue1','Pink'))

grid.arrange(p_hours, p_travel)
```



Looking at workweek and commute over time based on sex, we can see that between 1980-present, men have always averaged a longer workweek and commute. Commute seems to have grown more steadily over time than workweek. There is also a larger gender gap in average hours worked per week than in average commute time. An interesting finding would be that, for both men and women, average workweek decreased after 2008 (the Great Recession), and it has yet to reach the same level it was at before 2008. 





### How many hours does the average American work per week? How as that changed over time?
	
	  We found that most people worked an average of about 33 hours per week. We examined how this number has changed over the past 40 years, and recognized that there has been a subtle down trend in the amount of hours people work. We noted this especially after the Great Recession, when many people lost there jobs or had hours reduced. The most any respondant worked in an average week was 99 hours. 
	
    Descriptive statistics of peoples 2019 Work habits:
    ```{r}
    data %>%
      filter(CLASSWKR > 0 & YEAR == 2019) %>%
      select(UHRSWORK) %>%
      summary()
    ```
    
    
    Average work hours by year:
    ```{r}
    data %>%
      filter(CLASSWKR > 0) %>%
      group_by(YEAR) %>%
      summarise(UHRSWORK = mean(UHRSWORK)) %>%
      ggplot(aes(x=YEAR, y=UHRSWORK)) + geom_bar(fill = "deepskyblue", stat="identity") +
      labs(x="Year", y= "Average Hours Worked per week", title="Average Hours of Work Per Week per Year") +
      geom_vline(xintercept=2009, color="red") +
      annotate("label", x=2008, y=40, label="Great Recession", hjust=0, fill="red", color="white")
    ```

    Overall, hours worked per week has remained fairly static, and only has subtly decreaseed over the past 40 years. 

### What types of jobs typically require longer commutes and longer work weeks?

    We identified that there is a very clear divide in commute time and work time by jobs. Typically both federal and state governement employees seem to work the most on average, and commute the longest. This is sensible as there are a much more limited amount of governement offices. We first identified how many people work each job type, and found that most people work in private sector jobs. This is unsurprising. Examing commute time, as seen below, we discovered that most people's commutes have gotten longer.
    
    ```{r}
    data %>%
      filter(CLASSWKR > 0) %>%
      mutate(CLASSWKRD = as_factor(CLASSWKRD)) %>%
      group_by(YEAR, CLASSWKRD) %>%
      summarise(TRANTIME = mean(TRANTIME)) %>%
      ungroup() %>%
      ggplot(aes(x=YEAR, y=TRANTIME, group=CLASSWKRD, color=CLASSWKRD)) + geom_line() +
      labs(x="Job type", y= "Commute time (Minutes)", title="Commute time per job", fill="Job type")
      
    ```
    
    Similarly we have noticed a general decrease in hours worked across most job types. Notably, however, there was not a significant increase in hours worked for governement employees.
    

    ```{r}
    data %>%
      filter(CLASSWKR > 0) %>%
      mutate(CLASSWKRD = as_factor(CLASSWKRD)) %>%
      group_by(YEAR, CLASSWKRD) %>%
      summarise(UHRSWORK = mean(UHRSWORK),
                n = mean(n)) %>%
      ungroup() %>%
      ggplot(aes(x=YEAR, y=UHRSWORK, group=CLASSWKRD, color=CLASSWKRD)) + geom_line() +
      labs(x="Job type", y= "Hours Worked", title="Hours worked per job", fill="Job type")
      
    ```

### How does the American work life balance change in regards to income, marriage rates, and kids or dependents?  
```{r}
data2 <- data %>%
  select(UHRSWORK, NCHILD, INCTOT, FTOTINC,MARST, YEAR, TRANTIME) %>%
  rename(hours = UHRSWORK,
         dependents = NCHILD,
         incomesolo = INCTOT,
         incomefamily = FTOTINC,
         marital = MARST,
         year = YEAR,
         traintime = TRANTIME)
data2 <- na.omit(data2)
data2$married <- ifelse(data2$marital<=2, 1, 0) # 1 married, 0 not married
ggplot(data2, aes(y = hours, x = marital, fill=as_factor(marital)))+geom_boxplot()
ggplot(data2, aes(y = hours, x = dependents, fill=factor(dependents)))+geom_boxplot()
```
  
When we built the data set we initially tried to ad variables we thought would be important to determining work life balance, measured in hours worked per week. These included variables like marital status, family income, family size in regards to defendants, as well as other variables we thought may have been useful predictors. The two Plots I choose to explain this problem are above. These two plots are things that we thought would be very influential variables to determine work life balance but ended up having very little impact after all but ended up being less explanatory than we had predicted. They do a good job showing how little difference can be created as variables are changed. In the end we ended up finding that although the predictors we picked are valuable we discovered that they are not as valuable as we thought. There are probably many reliant predictors that we did not have access to that would have been more valuable but that is outside the scope of this analysis.

### What variables in our data set are significantly changed overtime when we predict income or family income?

### Are there any changes in the economic center cities and their proportion? Is this related to the changes in their life and work balance?

## Conclusion


## Contributions


Kerstin - I searched the IPUMS database for variables related to our research topic, selected samples during our specified time period, and extracted the data into a new file that the team could work with. I looked into and wrote the background information, introduction, and data collection materials for our presentation and this report. I also took on the question "how does gender play a role in work/life balance?". 
